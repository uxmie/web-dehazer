!function(){return function t(e,n,i){function r(o,y){if(!n[o]){if(!e[o]){var s="function"==typeof require&&require;if(!y&&s)return s(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[o]={exports:{}};e[o][0].call(h.exports,function(t){return r(e[o][1][t]||t)},h,h.exports,t,e,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}}()({1:[function(t,e,n){e.exports=
/**
 * hermite-resize - Canvas image resize/resample using Hermite filter with JavaScript.
 * @version v2.2.8
 * @link https://github.com/viliusle/miniPaint
 * @license MIT
 */
function(){var t,e,n=[];this.init=void(t=navigator.hardwareConcurrency||4),this.getCores=function(){return t},this.resample_auto=function(t,e,n,i,r){var a=this.getCores();window.Worker&&1<a?this.resample(t,e,n,i,r):(this.resample_single(t,e,n,!0),null!=r&&r())},this.resize_image=function(t,e,n,i,r){var a=document.getElementById(t),o=document.createElement("canvas");if(o.width=a.width,o.height=a.height,o.getContext("2d").drawImage(a,0,0),null==e&&null==n&&null!=i&&(e=a.width/100*i,n=a.height/100*i),null==n){var y=a.width/e;n=a.height/y}function s(){var t=o.toDataURL();a.width=e,a.height=n,a.src=t,o=t=null}e=Math.round(e),n=Math.round(n),null==r||1==r?this.resample(o,e,n,!0,s):(this.resample_single(o,e,n,!0),s())},this.resample=function(i,r,a,o,y){var s=i.width,l=i.height;r=Math.round(r);var h=l/(a=Math.round(a));if(0<n.length)for(var x=0;x<t;x++)null!=n[x]&&(n[x].terminate(),delete n[x]);n=new Array(t);var z=i.getContext("2d"),u=[],d=2*Math.ceil(l/t/2),c=-1;for(x=0;x<t;x++){var f,g=c+1;l<=g||(c=g+d-1,c=Math.min(c,l-1),f=Math.min(d,l-g),u[x]={},u[x].source=z.getImageData(0,g,s,d),u[x].target=!0,u[x].start_y=Math.ceil(g/h),u[x].height=f)}!0===o?(i.width=r,i.height=a):z.clearRect(0,0,s,l);var m=0;for(x=0;x<t;x++)if(null!=u[x]){m++;var p=new Worker(e);(n[x]=p).onmessage=function(t){m--;var e=t.data.core;n[e].terminate(),delete n[e];var i=Math.ceil(u[e].height/h);u[e].target=z.createImageData(r,i),u[e].target.data.set(t.data.target),z.putImageData(u[e].target,0,u[e].start_y),m<=0&&null!=y&&y()};var v={width_source:s,height_source:u[x].height,width:r,height:Math.ceil(u[x].height/h),core:x,source:u[x].source.data.buffer};p.postMessage(v,[v.source])}},e=window.URL.createObjectURL(new Blob(["(",function(){onmessage=function(t){for(var e=t.data.core,n=t.data.width_source,i=t.data.height_source,r=t.data.width,a=t.data.height,o=n/r,y=i/a,s=Math.ceil(o/2),l=Math.ceil(y/2),h=new Uint8ClampedArray(t.data.source),x=(h.length,r*a*4),z=new ArrayBuffer(x),u=new Uint8ClampedArray(z,0,x),d=0;d<a;d++)for(var c=0;c<r;c++){var f=4*(c+d*r),g=0,m=0,p=0,v=0,w=0,M=0,b=0,_=d*y,I=Math.floor(c*o),k=Math.ceil((c+1)*o),E=Math.floor(d*y),A=Math.ceil((d+1)*y);k=Math.min(k,n),A=Math.min(A,i);for(var j=E;j<A;j++)for(var B=Math.abs(_-j)/l,L=c*o,D=B*B,C=I;C<k;C++){var F=Math.abs(L-C)/s,S=Math.sqrt(D+F*F);if(!(1<=S)){var q=4*(C+j*n);b+=(g=2*S*S*S-3*S*S+1)*h[3+q],p+=g,h[3+q]<255&&(g=g*h[3+q]/250),v+=g*h[q],w+=g*h[1+q],M+=g*h[2+q],m+=g}}u[f]=v/m,u[1+f]=w/m,u[2+f]=M/m,u[3+f]=b/p}postMessage({core:e,target:u},[u.buffer])}}.toString(),")()"],{type:"application/javascript"})),this.resample_single=function(t,e,n,i){for(var r=t.width,a=t.height,o=r/(e=Math.round(e)),y=a/(n=Math.round(n)),s=Math.ceil(o/2),l=Math.ceil(y/2),h=t.getContext("2d"),x=h.getImageData(0,0,r,a),z=h.createImageData(e,n),u=x.data,d=z.data,c=0;c<n;c++)for(var f=0;f<e;f++){var g=4*(f+c*e),m=0,p=0,v=0,w=0,M=0,b=0,_=0,I=c*y,k=Math.floor(f*o),E=Math.ceil((f+1)*o),A=Math.floor(c*y),j=Math.ceil((c+1)*y);E=Math.min(E,r),j=Math.min(j,a);for(var B=A;B<j;B++)for(var L=Math.abs(I-B)/l,D=f*o,C=L*L,F=k;F<E;F++){var S=Math.abs(D-F)/s,q=Math.sqrt(C+S*S);if(!(1<=q)){var U=4*(F+B*r);_+=(m=2*q*q*q-3*q*q+1)*u[3+U],v+=m,u[3+U]<255&&(m=m*u[3+U]/250),w+=m*u[U],M+=m*u[1+U],b+=m*u[2+U],p+=m}}d[g]=w/p,d[1+g]=M/p,d[2+g]=b/p,d[3+g]=_/v}!0===i?(t.width=e,t.height=n):h.clearRect(0,0,r,a),h.putImageData(z,0,0)}}},{}],2:[function(t,e,n){var i=t("./utils.js"),r=i.arange,a=i.linRange;i.cartesian,i.range;function o(t,e,n,i,r,a,o){for(var y=a.length,s=new Uint32Array(i.length*r.length*y).fill(0),l=new Uint8ClampedArray(i.length*r.length*y).fill(0),h=0;h<t.length;h+=3){var x=i.findIndex(n=>n>t[h+e]),z=r.findIndex(e=>e>t[h+n]);if(!(x<0||z<0)){l.fill(0);for(var u=x;u<i.length;++u)for(var d=z;d<r.length;++d){var c=i[u],f=r[d],g=c-t[h+e],m=f-t[h+n],p=g/(k=Math.sqrt(g*g+m*m)),v=Math.acos(p),w=Math.round(v/Math.PI*2*y);w==y&&w--,l[(u*r.length+d)*y+w]=1;for(var M=0;M<y;++M){var b=Math.abs((c-t[h+e])*a[2*M]-(f-t[h+n])*a[2*M+1])<.1*(k*Math.SQRT1_2+1)?1:0;l[(u*r.length+d)*y+M]=b}}for(u=0;u<s.length;++u)s[u]+=l[u]}}var _=new Float32Array(i.length*r.length*y).fill(0);for(u=0;u<s.length;++u)if(!(s[u]<=1)){var I=Math.floor(u/y);for(c=i[Math.floor(I/r.length)],f=r[I%r.length],d=0;d<t.length;d+=3){g=c-t[d+e],m=f-t[d+n];var k=Math.sqrt(g*g+m*m),E=o[d/3]*Math.exp(5*-k+1);_[u]+=E}}var A=new Float32Array(i.length*r.length).fill(0);for(u=0;u<A.length;++u)for(d=0;d<y;++d)A[u]+=_[u*y+d];return A}e.exports=function(t,e,n,i){var y=i-n,s=0;s=y>.6?.05:y>.2?.03:.02;for(var l=e.quantizeID(t),h=new Float32Array(e.n_clusters).fill(0),x=0;x<l.length;++x)h[l[x]]++;var z=h.reduce((t,e)=>t+e);h=h.map(t=>t/z);var u=new Float32Array(e.centroids.slice(0));for(x=0;x<u.length;++x)u[x]/=255;var d=r(n,s,i),c=r(n,s,i),f=r(n,s,i),g=a(0,25,Math.PI/2),m=new Float32Array(50);for(x=0;x<25;x++)m[2*x]=Math.sin(g[x]),m[2*x+1]=Math.cos(g[x]);var p=o(u,0,1,d,c,m,h),v=o(u,1,2,c,f,m,h),w=o(u,0,2,d,f,m,h),M=new Float32Array(d.length*c.length*f.length);for(x=0;x<d.length;++x)for(var b=0;b<c.length;++b)for(var _=0;_<f.length;++_){var I=x*(c.length*f.length)+b*f.length+_,k=x*c.length+b,E=b*f.length+_,A=x*f.length+_;M[I]=p[k]*v[E]*w[A]}var j=M.indexOf(Math.max(...M)),B=Math.floor(j/(c.length*f.length)),L=Math.floor(j/f.length)%c.length,D=j%f.length,C=Array(3).fill(0),F=0;for(x=Math.max(B-1,0);x<Math.min(B+2,d.length);++x)for(b=Math.max(L-1,0);b<Math.min(L+2,c.length);++b)for(_=Math.max(D-1,0);_<Math.min(D+2,f.length);++_){var S=M[j=x*c.length*f.length+b*f.length+_];F+=S,C[0]+=d[x]*S,C[1]+=c[b]*S,C[2]+=f[_]*S}return C=C.map(t=>t/F)}},{"./utils.js":9}],3:[function(t,e,n){var i=t("./Hermite-resize/dist/hermite.npm.js"),r=t("./utils.js").cloneCanvas,a=t("webworkify");function o(t,e,n,i){var a=new Number(document.getElementById("hazeAmountSlide").value),o=new Number(document.getElementById("distSlide").value),s=new Number(document.getElementById("gammaOutSlide").value),h=Math.pow(2,o);window.dehazeFlat=function(t,e,n,i){for(var r=t.getContext("2d").getImageData(0,0,t.width,t.height).data,a=new Uint8ClampedArray(4*e.length).fill(255),o=0;o<e.length;++o){var y=e[o]*i;a[4*o]=(r[4*o]-(1-y)*n[0]*255)/(y+1e-4),a[4*o+1]=(r[4*o+1]-(1-y)*n[1]*255)/(y+1e-4),a[4*o+2]=(r[4*o+2]-(1-y)*n[2]*255)/(y+1e-4)}return a}(t,n,i,h),y(window.dehazeFlat,t.width,t.height,e,n,i,a),window.dehazedCanvas=r(e),l(window.dehazedCanvas,e,1/s)}function y(t,e,n,i,r,a,o){for(var y=new Uint8ClampedArray(t.length).fill(255),s=0;s<r.length;s++){var l=Math.pow(r[s],o);y[4*s]=l*t[4*s]+(1-l)*a[0]*255,y[4*s+1]=l*t[4*s+1]+(1-l)*a[1]*255,y[4*s+2]=l*t[4*s+2]+(1-l)*a[2]*255}i.width=e,i.height=n;var h=i.getContext("2d"),x=h.createImageData(e,n);x.data.set(y),h.putImageData(x,0,0)}function s(t,e,n,i){for(var r=t.getContext("2d"),a=new Uint8ClampedArray(4*e.length),o=0;o<e.length;++o){var y=e[o];a[4*o]=255*y,a[4*o+1]=255*y,a[4*o+2]=255*y,a[4*o+3]=255}t.width=n,t.height=i;var s=r.createImageData(t.width,t.height);s.data.set(a),r.putImageData(s,0,0)}function l(t,e,n){n=1/n;for(var i=e.getContext("2d"),r=t.getContext("2d").getImageData(0,0,e.width,e.height).data,a=new Uint8ClampedArray(r.length).fill(255),o=0;o<r.length;o+=4)a[o]=255*Math.pow(r[o]/255,n),a[o+1]=255*Math.pow(r[o+1]/255,n),a[o+2]=255*Math.pow(r[o+2]/255,n);var y=i.createImageData(e.width,e.height);y.data.set(a),i.putImageData(y,0,0)}e.exports.processImage=function(t){var e=new Number(document.getElementById("gammaSlide").value),n=document.getElementById("originalPic"),a=n.getContext("2d");n.width=t.width,n.height=t.height,a.drawImage(t,0,0),window.origNonResize=r(n);var o=1;t.width>600&&(o=600/t.width),t.height*o>600&&(o=600/t.height),(new i).resample(n,Math.round(t.width*o),Math.round(t.height*o),!0,function(){window.origCanvas=r(n),l(window.origCanvas,n,e),n.style.visibility="visible"})},e.exports.sliderChange=function(t,e){e.innerHTML=t.value},e.exports.changeGamma=l,e.exports.dehazePreview=function(){var e=new Date,n=document.getElementById("originalPic"),i=new Number(document.getElementById("minAirSlide").value),r=new Number(document.getElementById("maxAirSlide").value),y=n.getContext("2d").getImageData(0,0,n.width,n.height).data.slice(0),l=n.width,h=n.height,x=document.getElementById("statusUpdate"),z=Array.from(document.getElementsByClassName("loading"));z.forEach(t=>t.style.visibility="visible");var u=a(t("../workers/dehazer_worker.js"));u.onmessage=function(t){if("finish"===t.data.signal){window.airLight=t.data.airLight;var i=document.getElementById("airLightPreview"),r=window.airLight.map(t=>Math.round(255*t)),a="rgb("+r[0]+","+r[1]+","+r[2]+")";i.style.backgroundColor=a,window.transmittance=t.data.transmittance;var y=new Date;console.log("Finished transmittance map in "+(y-e)/1e3+" secs."),x.innerHTML="Post processingâ€¦",s(document.getElementById("transmittanceResultsPic"),window.transmittance,n.width,n.height);var l=document.getElementById("dehazeResult");o(n,l,window.transmittance,window.airLight),z.forEach(t=>t.style.visibility="hidden"),document.getElementById("transmittanceDiv").style.visibility="visible"}else x.innerHTML=t.data.signal},u.postMessage({image:y,clusters:500,minEst:i,maxEst:r,picWidth:l,picHeight:h},[y.buffer])},e.exports.findAirLight=function(){var e=document.getElementById("originalPic"),n=new Number(document.getElementById("minAirSlide").value),i=new Number(document.getElementById("maxAirSlide").value),r=e.getContext("2d").getImageData(0,0,e.width,e.height).data.slice(0),o=a(t("../workers/kdtree_worker.js"));o.onmessage=function(t){window.airLight=t.data;var e=document.getElementById("airLightPreview"),n=t.data.map(t=>Math.round(255*t)),i="rgb("+n[0]+","+n[1]+","+n[2]+")";e.style.backgroundColor=i},o.postMessage({image:r,clusters:500,minEst:n,maxEst:i},[r.buffer])},e.exports.findAndDrawResults=function(){var e=document.getElementById("originalPic"),n=e.getContext("2d"),i=e.width,r=e.height,y=n.getImageData(0,0,i,r).data,l=new Date,h=a(t("../workers/transmittance_worker.js"));h.onmessage=function(t){window.transmittance=t.data;var n=new Date;console.log("Finished transmittance map in "+(n-l)/1e3+" secs."),s(document.getElementById("transmittanceResultsPic"),window.transmittance,e.width,e.height);var i=document.getElementById("dehazeResult");o(e,i,window.transmittance,window.airLight)},h.postMessage({colorArray:y,picWidth:i,picHeight:r,airLight:window.airLight},[y.buffer])},e.exports.drawDehazed=o,e.exports.mixHaze=y,e.exports.calculateOriginal=function(){var e=document.getElementById("gammaSlide").value;l(window.origNonResize,window.origNonResize,e);var n=new Date,i=window.origNonResize.getContext("2d"),r=window.origNonResize.width,y=window.origNonResize.height,s=i.getImageData(0,0,r,y).data,h=document.getElementById("statusUpdate"),x=Array.from(document.getElementsByClassName("loading"));x.forEach(t=>t.style.visibility="visible");var z=a(t("../workers/transmittance_worker.js"));z.onmessage=function(t){if("finish"===t.data.signal){var e=t.data.transmittance,i=new Date;console.log("Finished transmittance map in "+(i-n)/1e3+" secs.");var r=document.createElement("canvas");o(window.origNonResize,r,e,window.airLight),console.log(r.width);var a=document.getElementById("downloadLink");r.toBlob(function(t){a.href=URL.createObjectURL(t)});var y=function(){requestAnimationFrame(function(){URL.revokeObjectURL(this.href),this.href=null}),this.removeEventListener("click",y)};a.addEventListener("click",y),a.download="dehazed.png",x.forEach(t=>t.style.visibility="hidden"),document.getElementById("transmittanceDiv").style.visibility="visible"}else h.innerHTML=t.data.signal},z.postMessage({colorArray:s,picWidth:r,picHeight:y,airLight:window.airLight},[s.buffer])}},{"../workers/dehazer_worker.js":12,"../workers/kdtree_worker.js":13,"../workers/transmittance_worker.js":14,"./Hermite-resize/dist/hermite.npm.js":1,"./utils.js":9,webworkify:11}],4:[function(t,e,n){(function(i){!function(t){if("object"==typeof n&&void 0!==e)e.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).PriorityQueue=t()}}(function(){return function e(n,i,r){function a(y,s){if(!i[y]){if(!n[y]){var l="function"==typeof t&&t;if(!s&&l)return l(y,!0);if(o)return o(y,!0);var h=new Error("Cannot find module '"+y+"'");throw h.code="MODULE_NOT_FOUND",h}var x=i[y]={exports:{}};n[y][0].call(x.exports,function(t){var e=n[y][1][t];return a(e||t)},x,x.exports,e,n,i,r)}return i[y].exports}for(var o="function"==typeof t&&t,y=0;y<r.length;y++)a(r[y]);return a}({1:[function(t,e,n){var i,r,a,o,y,s={}.hasOwnProperty;i=t("./PriorityQueue/AbstractPriorityQueue"),r=t("./PriorityQueue/ArrayStrategy"),o=t("./PriorityQueue/BinaryHeapStrategy"),a=t("./PriorityQueue/BHeapStrategy"),(y=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=o),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,i),e}()).ArrayStrategy=r,y.BinaryHeapStrategy=o,y.BHeapStrategy=a,e.exports=y},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,e,n){e.exports=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){this.length++,this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t}()},{}],3:[function(t,e,n){var i;i=function(t,e,n){var i,r,a;for(r=0,i=t.length;r<i;)n(t[a=r+i>>>1],e)>=0?r=a+1:i=a;return r},e.exports=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;e=i(this.data,t,this.comparator),this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){this.data.length=0},t}()},{}],4:[function(t,e,n){e.exports=function(){function t(t){var e,n,i,r,a,o,y,s;for(this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.pageSize=(null!=t?t.pageSize:void 0)||512,this.length=0,y=0;1<<y<this.pageSize;)y+=1;if(1<<y!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=y,this._emptyMemoryPageTemplate=e=[],n=0,a=this.pageSize;0<=a?n<a:n>a;0<=a?++n:--n)e.push(null);if(this._memory=[],this._mask=this.pageSize-1,t.initialValues)for(i=0,r=(o=t.initialValues).length;i<r;i++)s=o[i],this.queue(s)}return t.prototype.queue=function(t){this.length+=1,this._write(this.length,t),this._bubbleUp(this.length,t)},t.prototype.dequeue=function(){var t,e;return t=this._read(1),e=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,e),this._bubbleDown(1,e)),t},t.prototype.peek=function(){return this._read(1)},t.prototype.clear=function(){this.length=0,this._memory.length=0},t.prototype._write=function(t,e){var n;for(n=t>>this._shift;n>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[n][t&this._mask]=e},t.prototype._read=function(t){return this._memory[t>>this._shift][t&this._mask]},t.prototype._bubbleUp=function(t,e){var n,i,r,a;for(n=this.comparator;t>1&&(i=t&this._mask,t<this.pageSize||i>3?r=t&~this._mask|i>>1:i<2?(r=t-this.pageSize>>this._shift,r+=r&~(this._mask>>1),r|=this.pageSize>>1):r=t-2,!(n(a=this._read(r),e)<0));)this._write(r,e),this._write(t,a),t=r},t.prototype._bubbleDown=function(t,e){var n,i,r,a,o;for(o=this.comparator;t<this.length;)if(t>this._mask&&!(t&this._mask-1)?n=i=t+2:t&this.pageSize>>1?(n=(t&~this._mask)>>1,i=(n=(n|=t&this._mask>>1)+1<<this._shift)+1):i=(n=t+(t&this._mask))+1,n!==i&&i<=this.length)if(r=this._read(n),a=this._read(i),o(r,e)<0&&o(r,a)<=0)this._write(n,e),this._write(t,r),t=n;else{if(!(o(a,e)<0))break;this._write(i,e),this._write(t,a),t=i}else{if(!(n<=this.length))break;if(!(o(r=this._read(n),e)<0))break;this._write(n,e),this._write(t,r),t=n}},t}()},{}],5:[function(t,e,n){e.exports=function(){function t(t){var e;this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.length=0,this.data=(null!=(e=t.initialValues)?e.slice(0):void 0)||[],this._heapify()}return t.prototype._heapify=function(){var t,e,n;if(this.data.length>0)for(t=e=1,n=this.data.length;1<=n?e<n:e>n;t=1<=n?++e:--e)this._bubbleUp(t)},t.prototype.queue=function(t){this.data.push(t),this._bubbleUp(this.data.length-1)},t.prototype.dequeue=function(){var t,e;return e=this.data[0],t=this.data.pop(),this.data.length>0&&(this.data[0]=t,this._bubbleDown(0)),e},t.prototype.peek=function(){return this.data[0]},t.prototype.clear=function(){this.length=0,this.data.length=0},t.prototype._bubbleUp=function(t){for(var e,n;t>0&&(e=t-1>>>1,this.comparator(this.data[t],this.data[e])<0);)n=this.data[e],this.data[e]=this.data[t],this.data[t]=n,t=e},t.prototype._bubbleDown=function(t){var e,n,i,r,a;for(e=this.data.length-1;r=(n=1+(t<<1))+1,i=t,n<=e&&this.comparator(this.data[n],this.data[i])<0&&(i=n),r<=e&&this.comparator(this.data[r],this.data[i])<0&&(i=r),i!==t;)a=this.data[i],this.data[i]=this.data[t],this.data[t]=a,t=i},t}()},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,n){
/**
 * k-d Tree JavaScript - V 1.01
 *
 * https://github.com/ubilabs/kd-tree-javascript
 *
 * @author Mircea Pricop <pricop@ubilabs.net>, 2012
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */var i,r;i=this,r=function(t){function e(t,e,n){this.obj=t,this.left=null,this.right=null,this.parent=n,this.dimension=e}function n(t){this.content=[],this.scoreFunction=t}n.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var i=this.content.pop();return void(n!=e-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t];t>0;){var n=Math.floor((t+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[n]=e,this.content[t]=i,t=n}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);;){var r=2*(t+1),a=r-1,o=null;if(a<e){var y=this.content[a],s=this.scoreFunction(y);s<i&&(o=a)}if(r<e){var l=this.content[r];this.scoreFunction(l)<(null==o?i:s)&&(o=r)}if(null==o)break;this.content[t]=this.content[o],this.content[o]=n,t=o}}},t.kdTree=function(t,i,r){var a,o=this;Array.isArray(t)?this.root=function t(n,i,a){var o,y,s=i%r.length;return 0===n.length?null:1===n.length?new e(n[0],s,a):(n.sort(function(t,e){return t[r[s]]-e[r[s]]}),(y=new e(n[o=Math.floor(n.length/2)],s,a)).left=t(n.slice(0,o),i+1,y),y.right=t(n.slice(o+1),i+1,y),y)}(t,0,null):(a=t,o.root=a,function t(e){e.left&&(e.left.parent=e,t(e.left)),e.right&&(e.right.parent=e,t(e.right))}(o.root)),this.toJSON=function(t){t||(t=this.root);var n=new e(t.obj,t.dimension,null);return t.left&&(n.left=o.toJSON(t.left)),t.right&&(n.right=o.toJSON(t.right)),n},this.insert=function(t){var n,i,a=function e(n,i){if(null===n)return i;var a=r[n.dimension];return t[a]<n.obj[a]?e(n.left,n):e(n.right,n)}(this.root,null);null!==a?(n=new e(t,(a.dimension+1)%r.length,a),i=r[a.dimension],t[i]<a.obj[i]?a.left=n:a.right=n):this.root=new e(t,0,null)},this.remove=function(t){var e;null!==(e=function e(n){if(null===n)return null;if(n.obj===t)return n;var i=r[n.dimension];return t[i]<n.obj[i]?e(n.left):e(n.right)}(o.root))&&function t(e){var n,i,a;function y(t,e){var n,i,a,o,s;return null===t?null:(n=r[e],t.dimension===e?null!==t.left?y(t.left,e):t:(i=t.obj[n],a=y(t.left,e),o=y(t.right,e),s=t,null!==a&&a.obj[n]<i&&(s=a),null!==o&&o.obj[n]<s.obj[n]&&(s=o),s))}if(null===e.left&&null===e.right)return null===e.parent?void(o.root=null):(a=r[e.parent.dimension],void(e.obj[a]<e.parent.obj[a]?e.parent.left=null:e.parent.right=null));null!==e.right?(i=(n=y(e.right,e.dimension)).obj,t(n),e.obj=i):(i=(n=y(e.left,e.dimension)).obj,t(n),e.right=e.left,e.left=null,e.obj=i)}(e)},this.nearest=function(t,e,a){var y,s,l;if(l=new n(function(t){return-t[1]}),a)for(y=0;y<e;y+=1)l.push([null,a]);for(o.root&&function n(a){var o,y,s,h,x=r[a.dimension],z=i(t,a.obj),u={};function d(t,n){l.push([t,n]),l.size()>e&&l.pop()}for(h=0;h<r.length;h+=1)h===a.dimension?u[r[h]]=t[r[h]]:u[r[h]]=a.obj[r[h]];y=i(u,a.obj),null!==a.right||null!==a.left?(n(o=null===a.right?a.left:null===a.left?a.right:t[x]<a.obj[x]?a.left:a.right),(l.size()<e||z<l.peek()[1])&&d(a,z),(l.size()<e||Math.abs(y)<l.peek()[1])&&null!==(s=o===a.left?a.right:a.left)&&n(s)):(l.size()<e||z<l.peek()[1])&&d(a,z)}(o.root),s=[],y=0;y<Math.min(e,l.content.length);y+=1)l.content[y][0]&&s.push([l.content[y][0].obj,l.content[y][1]]);return s},this.balanceFactor=function(){return function t(e){return null===e?0:Math.max(t(e.left),t(e.right))+1}(o.root)/(Math.log(function t(e){return null===e?0:t(e.left)+t(e.right)+1}(o.root))/Math.log(2))}},t.BinaryHeap=n},"function"==typeof define&&define.amd?define(["exports"],r):r("object"==typeof n?n:i)},{}],6:[function(t,e,n){var r=t("./js-priority-queue/priority-queue.js");function a(t,e,n,i,r,a){this.minVal=i.slice(0),this.maxVal=r.slice(0),this.startIdx=e,this.endIdx=n,this.splitChannel=-1,this.splitThreshold=-1,this.splitVariance=-1,this.left=-1,this.right=-1,this.parent=a,this.isLeaf=!0,this.index=-1;for(var o=0;o<3;o++){for(var y=new Uint32Array(256).fill(0),s=this.startIdx;s<this.endIdx;++s)y[t[4*s+o]]++;var l=0,h=0,x=y.map((t,e)=>t*e).reduce((t,e)=>t+e,0),z=y.reduce((t,e)=>t+e,0);for(s=0;s<256;++s){var u=z-(h+=y[s]);if(0!=h&&0!=u){var d=(l+=s*y[s])/h-(x-l)/u,c=h*u*d*d;c>=this.splitVariance&&(this.splitChannel=o,this.splitThreshold=s,this.splitVariance=c)}}}}function o(t,e){var n=new r({comparator:function(t,e){return e.splitVariance-t.splitVariance}});n.queue(new a(t,0,t.length/4,[0,0,0],[255,255,252],-1)),console.log("ha"),this.kdtree=Array(2*e-1);for(var i=0,o=0;n.length>0&&o+n.length<e;){if((g=n.dequeue()).parent>=0)(m=this.kdtree[g.parent]).minVal.every((t,e)=>t===g.minVal[e])?m.left=i:m.right=i;if(this.kdtree[i]=g,-1!=g.splitChannel){var y=g.splitChannel,s=g.splitThreshold,l=g.startIdx-1,h=g.startIdx;for(h=g.startIdx;h<g.endIdx;++h)if(t[4*h+y]<s)for(var x=4*++l,z=4*h,u=0;u<4;++u){var d=t[z+u];t[z+u]=t[x+u],t[x+u]=d}var c=l+1;if(c!=g.startIdx&&c!=g.endIdx){var f=g.maxVal.slice(0);f[y]=s,n.queue(new a(t,g.startIdx,c,g.minVal,f,i)),(f=g.minVal.slice(0))[y]=s+1,n.queue(new a(t,c,g.endIdx,f,g.maxVal,i)),this.kdtree[i].isLeaf=!1,i++}else i++,o++}else i++,o++}for(;n.length>0;){var g,m;if((g=n.dequeue()).parent>=0)(m=this.kdtree[g.parent]).minVal.every((t,e)=>t===g.minVal[e])?m.left=i:m.right=i;this.kdtree[i]=g,i++}var p=0;this.centroids=new Uint8ClampedArray(3*e),this.n_clusters=e;for(var v=0;v<i;++v)if(this.kdtree[v].isLeaf){this.kdtree[v].index=p;var w=this.kdtree[v],M=[0,0,0];for(u=4*w.startIdx;u<4*w.endIdx;u+=4)M[0]+=t[u],M[1]+=t[u+1],M[2]+=t[u+2];var b=w.endIdx-w.startIdx;this.centroids[3*p]=Math.round(M[0]/b),this.centroids[3*p+1]=Math.round(M[1]/b),this.centroids[3*p+2]=Math.round(M[2]/b),w.centroid=this.centroids.slice(3*p,3*p+3),p++}}o.prototype.lookupColor=function(t){for(var e=this.kdtree[0];!e.isLeaf;){e=t[e.splitChannel]<e.splitThreshold?this.kdtree[e.left]:this.kdtree[e.right]}return e.centroid.slice(0)},o.prototype.lookupID=function(t){for(var e=this.kdtree[0];!e.isLeaf;){e=t[e.splitChannel]<e.splitThreshold?this.kdtree[e.left]:this.kdtree[e.right]}return e.index},o.prototype.quantizeID=function(t){var e=new Uint16Array(t.length/4);for(i=0;i<t.length/4;i++)e[i]=this.lookupID(t.slice(4*i,4*i+3));return e},e.exports=o},{"./js-priority-queue/priority-queue.js":4}],7:[function(t,e,n){var i=t("./utils.js"),r=t("./kd-tree-javascript/kdTree.js");kd_tree_sample_points=[{x:0,y:-1,z:0},{x:.723607,y:-.44722,z:.525725},{x:-.276388,y:-.44722,z:.850649},{x:-.894426,y:-.447216,z:0},{x:-.276388,y:-.44722,z:-.850649},{x:.723607,y:-.44722,z:-.525725},{x:.276388,y:.44722,z:.850649},{x:-.723607,y:.44722,z:.525725},{x:-.723607,y:.44722,z:-.525725},{x:.276388,y:.44722,z:-.850649},{x:.894426,y:.447216,z:0},{x:0,y:1,z:0},{x:-.257937,y:-.550685,z:.79386},{x:-.232822,y:-.657519,z:.716563},{x:-.200688,y:-.760403,z:.617666},{x:-.162456,y:-.850654,z:.499995},{x:-.120413,y:-.920955,z:.370598},{x:-.077607,y:-.96795,z:.238853},{x:-.036848,y:-.992865,z:.113408},{x:.096471,y:-.992865,z:.070089},{x:.203181,y:-.96795,z:.147618},{x:.315251,y:-.920955,z:.22904},{x:.425323,y:-.850654,z:.309011},{x:.52542,y:-.760403,z:.381735},{x:.609547,y:-.657519,z:.442856},{x:.6753,y:-.550685,z:.490628},{x:.638452,y:-.476987,z:.604038},{x:.531941,y:-.502302,z:.681712},{x:.405008,y:-.519572,z:.752338},{x:.262869,y:-.525738,z:.809012},{x:.114564,y:-.519572,z:.846711},{x:-.029639,y:-.502302,z:.864184},{x:-.161465,y:-.476988,z:.863951},{x:.771771,y:-.476987,z:-.420539},{x:.812729,y:-.502301,z:-.295238},{x:.840673,y:-.519571,z:-.152694},{x:.850648,y:-.525736,z:0},{x:.840673,y:-.519571,z:.152694},{x:.812729,y:-.502301,z:.295238},{x:.771771,y:-.476987,z:.420539},{x:.096471,y:-.992865,z:-.070089},{x:.203181,y:-.96795,z:-.147618},{x:.315251,y:-.920955,z:-.22904},{x:.425323,y:-.850654,z:-.309011},{x:.52542,y:-.760403,z:-.381735},{x:.609547,y:-.657519,z:-.442856},{x:.6753,y:-.550685,z:-.490628},{x:-.834716,y:-.550681,z:0},{x:-.753442,y:-.657515,z:0},{x:-.649456,y:-.760399,z:0},{x:-.52573,y:-.850652,z:0},{x:-.389673,y:-.920953,z:0},{x:-.251147,y:-.967949,z:0},{x:-.119245,y:-.992865,z:0},{x:-.377183,y:-.476988,z:.793861},{x:-.483971,y:-.502302,z:.716565},{x:-.590366,y:-.519572,z:.617668},{x:-.688189,y:-.525736,z:.499997},{x:-.769872,y:-.51957,z:.3706},{x:-.831051,y:-.502299,z:.238853},{x:-.871565,y:-.476984,z:.113408},{x:-.257937,y:-.550685,z:-.79386},{x:-.232822,y:-.657519,z:-.716563},{x:-.200688,y:-.760403,z:-.617666},{x:-.162456,y:-.850654,z:-.499995},{x:-.120413,y:-.920955,z:-.370598},{x:-.077607,y:-.96795,z:-.238853},{x:-.036848,y:-.992865,z:-.113408},{x:-.871565,y:-.476984,z:-.113408},{x:-.831051,y:-.502299,z:-.238853},{x:-.769872,y:-.51957,z:-.3706},{x:-.688189,y:-.525736,z:-.499997},{x:-.590366,y:-.519572,z:-.617668},{x:-.483971,y:-.502302,z:-.716565},{x:-.377183,y:-.476988,z:-.793861},{x:-.161465,y:-.476988,z:-.863951},{x:-.029639,y:-.502302,z:-.864184},{x:.114564,y:-.519573,z:-.846711},{x:.262869,y:-.525738,z:-.809012},{x:.405008,y:-.519572,z:-.752338},{x:.531941,y:-.502302,z:-.681712},{x:.638453,y:-.476987,z:-.604038},{x:.931188,y:.357738,z:.070089},{x:.956626,y:.251149,z:.147618},{x:.964711,y:.129893,z:.229041},{x:.951058,y:-0,z:.309013},{x:.915098,y:-.129893,z:.381737},{x:.860698,y:-.251151,z:.442858},{x:.794547,y:-.357741,z:.490629},{x:.794547,y:-.357741,z:-.490629},{x:.860698,y:-.251151,z:-.442858},{x:.915098,y:-.129893,z:-.381737},{x:.951058,y:0,z:-.309013},{x:.964711,y:.129893,z:-.229041},{x:.956626,y:.251149,z:-.147618},{x:.931188,y:.357738,z:-.070089},{x:.221089,y:.357741,z:.907271},{x:.155215,y:.251152,z:.955422},{x:.080276,y:.129894,z:.988273},{x:-0,y:-0,z:1},{x:-.080276,y:-.129894,z:.988273},{x:-.155215,y:-.251152,z:.955422},{x:-.221089,y:-.357741,z:.907271},{x:.71215,y:-.357741,z:.604039},{x:.687159,y:-.251152,z:.681715},{x:.645839,y:-.129894,z:.752343},{x:.587786,y:0,z:.809017},{x:.515946,y:.129894,z:.846716},{x:.436007,y:.251152,z:.864188},{x:.354409,y:.357742,z:.863953},{x:-.794547,y:.357741,z:.490629},{x:-.860698,y:.251151,z:.442858},{x:-.915098,y:.129893,z:.381737},{x:-.951058,y:-0,z:.309013},{x:-.964711,y:-.129893,z:.229041},{x:-.956626,y:-.251149,z:.147618},{x:-.931188,y:-.357738,z:.070089},{x:-.354409,y:-.357742,z:.863953},{x:-.436007,y:-.251152,z:.864188},{x:-.515946,y:-.129894,z:.846716},{x:-.587786,y:0,z:.809017},{x:-.645839,y:.129894,z:.752342},{x:-.687159,y:.251152,z:.681715},{x:-.71215,y:.357741,z:.604039},{x:-.71215,y:.357741,z:-.604039},{x:-.687159,y:.251152,z:-.681715},{x:-.645839,y:.129894,z:-.752343},{x:-.587786,y:-0,z:-.809017},{x:-.515946,y:-.129894,z:-.846716},{x:-.436007,y:-.251152,z:-.864188},{x:-.354409,y:-.357742,z:-.863953},{x:-.931188,y:-.357738,z:-.070089},{x:-.956626,y:-.251149,z:-.147618},{x:-.964711,y:-.129893,z:-.229041},{x:-.951058,y:0,z:-.309013},{x:-.915098,y:.129893,z:-.381737},{x:-.860698,y:.251151,z:-.442858},{x:-.794547,y:.357741,z:-.490629},{x:.354409,y:.357742,z:-.863953},{x:.436007,y:.251152,z:-.864188},{x:.515946,y:.129894,z:-.846716},{x:.587786,y:-0,z:-.809017},{x:.645839,y:-.129894,z:-.752342},{x:.687159,y:-.251152,z:-.681715},{x:.71215,y:-.357741,z:-.604039},{x:-.221089,y:-.357741,z:-.907271},{x:-.155215,y:-.251152,z:-.955422},{x:-.080276,y:-.129894,z:-.988273},{x:0,y:0,z:-1},{x:.080276,y:.129894,z:-.988273},{x:.155215,y:.251152,z:-.955422},{x:.221089,y:.357741,z:-.907271},{x:.871565,y:.476984,z:.113408},{x:.831051,y:.502299,z:.238853},{x:.769872,y:.51957,z:.3706},{x:.688189,y:.525736,z:.499997},{x:.590366,y:.519572,z:.617668},{x:.483971,y:.502302,z:.716565},{x:.377183,y:.476988,z:.793861},{x:.161465,y:.476988,z:.863951},{x:.029639,y:.502302,z:.864184},{x:-.114564,y:.519573,z:.846711},{x:-.262869,y:.525738,z:.809012},{x:-.405008,y:.519572,z:.752338},{x:-.531941,y:.502302,z:.681712},{x:-.638453,y:.476987,z:.604038},{x:-.771771,y:.476987,z:.420539},{x:-.812729,y:.502301,z:.295238},{x:-.840673,y:.519571,z:.152694},{x:-.850648,y:.525736,z:-0},{x:-.840673,y:.519571,z:-.152694},{x:-.812729,y:.502301,z:-.295238},{x:-.771771,y:.476987,z:-.420539},{x:-.638452,y:.476987,z:-.604038},{x:-.531941,y:.502302,z:-.681712},{x:-.405008,y:.519572,z:-.752338},{x:-.262869,y:.525738,z:-.809012},{x:-.114564,y:.519572,z:-.846711},{x:.029639,y:.502302,z:-.864184},{x:.161465,y:.476988,z:-.863951},{x:.377183,y:.476988,z:-.793861},{x:.483971,y:.502302,z:-.716565},{x:.590366,y:.519572,z:-.617668},{x:.688189,y:.525736,z:-.499997},{x:.769872,y:.51957,z:-.3706},{x:.831051,y:.502299,z:-.238853},{x:.871565,y:.476984,z:-.113408},{x:.036848,y:.992865,z:.113408},{x:.077607,y:.96795,z:.238853},{x:.120413,y:.920955,z:.370598},{x:.162456,y:.850654,z:.499995},{x:.200688,y:.760403,z:.617666},{x:.232822,y:.657519,z:.716563},{x:.257937,y:.550685,z:.79386},{x:.834716,y:.550681,z:0},{x:.753442,y:.657515,z:0},{x:.649456,y:.760399,z:0},{x:.52573,y:.850652,z:0},{x:.389673,y:.920953,z:0},{x:.251147,y:.967949,z:0},{x:.119245,y:.992865,z:0},{x:-.096471,y:.992865,z:.070089},{x:-.203181,y:.96795,z:.147618},{x:-.315251,y:.920955,z:.22904},{x:-.425323,y:.850654,z:.309011},{x:-.52542,y:.760403,z:.381735},{x:-.609547,y:.657519,z:.442856},{x:-.6753,y:.550685,z:.490628},{x:-.096471,y:.992865,z:-.070089},{x:-.203181,y:.96795,z:-.147618},{x:-.315251,y:.920955,z:-.22904},{x:-.425323,y:.850654,z:-.309011},{x:-.52542,y:.760403,z:-.381735},{x:-.609547,y:.657519,z:-.442856},{x:-.6753,y:.550685,z:-.490628},{x:.036848,y:.992865,z:-.113408},{x:.077607,y:.96795,z:-.238853},{x:.120413,y:.920955,z:-.370598},{x:.162456,y:.850654,z:-.499995},{x:.200688,y:.760403,z:-.617666},{x:.232822,y:.657519,z:-.716563},{x:.257937,y:.550685,z:-.79386},{x:.166198,y:.978672,z:-.120749},{x:.307167,y:.943208,z:-.126518},{x:.215245,y:.943209,z:-.253036},{x:.451375,y:.882854,z:-.129731},{x:.3618,y:.894429,z:-.262863},{x:.262862,y:.882855,z:-.389192},{x:.587783,y:.798549,z:-.129731},{x:.506729,y:.819912,z:-.266403},{x:.409951,y:.819913,z:-.399604},{x:.305014,y:.798552,z:-.518924},{x:.706258,y:.696558,z:-.126519},{x:.638194,y:.72361,z:-.262864},{x:.550008,y:.733353,z:-.399605},{x:.447209,y:.723612,z:-.525728},{x:.338569,y:.696561,z:-.632593},{x:.801022,y:.586331,z:-.12075},{x:.747366,y:.614342,z:-.253038},{x:.672087,y:.629942,z:-.389194},{x:.57783,y:.629943,z:-.518926},{x:.471599,y:.614344,z:-.632594},{x:.362366,y:.586334,z:-.724502},{x:-.063483,y:.978672,z:-.195376},{x:-.025408,y:.943209,z:-.331227},{x:-.174138,y:.943209,z:-.282901},{x:.016098,y:.882855,z:-.469369},{x:-.138197,y:.89443,z:-.425319},{x:-.288916,y:.882855,z:-.370262},{x:.05825,y:.798552,z:-.599101},{x:-.096779,y:.819914,z:-.564248},{x:-.253366,y:.819914,z:-.513369},{x:-.399272,y:.798552,z:-.45044},{x:.097915,y:.696561,z:-.710785},{x:-.05279,y:.723612,z:-.688185},{x:-.210088,y:.733355,z:-.646571},{x:-.361804,y:.723612,z:-.587778},{x:-.497009,y:.696561,z:-.517479},{x:.132684,y:.586334,z:-.799129},{x:-.009708,y:.614345,z:-.788978},{x:-.162463,y:.629944,z:-.759458},{x:-.314971,y:.629944,z:-.709904},{x:-.455902,y:.614344,z:-.643998},{x:-.577066,y:.586334,z:-.568513},{x:-.205432,y:.978671,z:0},{x:-.322868,y:.943208,z:-.078192},{x:-.322868,y:.943208,z:.078192},{x:-.441423,y:.882855,z:-.160354},{x:-.44721,y:.894429,z:0},{x:-.441423,y:.882855,z:.160354},{x:-.551779,y:.798551,z:-.240532},{x:-.566539,y:.819912,z:-.082322},{x:-.566539,y:.819912,z:.082322},{x:-.551779,y:.798551,z:.240532},{x:-.64574,y:.696561,z:-.312768},{x:-.670817,y:.723611,z:-.162457},{x:-.679848,y:.733353,z:0},{x:-.670817,y:.723611,z:.162457},{x:-.64574,y:.69656,z:.312768},{x:-.719015,y:.586334,z:-.373135},{x:-.753363,y:.614343,z:-.234576},{x:-.772492,y:.629942,z:-.080177},{x:-.772492,y:.629942,z:.080177},{x:-.753363,y:.614343,z:.234576},{x:-.719015,y:.586334,z:.373135},{x:-.063483,y:.978672,z:.195376},{x:-.174138,y:.943209,z:.282901},{x:-.025408,y:.943209,z:.331227},{x:-.288916,y:.882855,z:.370262},{x:-.138197,y:.89443,z:.425319},{x:.016098,y:.882855,z:.469369},{x:-.399272,y:.798552,z:.45044},{x:-.253366,y:.819914,z:.513369},{x:-.096779,y:.819914,z:.564248},{x:.05825,y:.798552,z:.599101},{x:-.497009,y:.696561,z:.517479},{x:-.361804,y:.723612,z:.587778},{x:-.210088,y:.733355,z:.646571},{x:-.05279,y:.723612,z:.688185},{x:.097915,y:.696561,z:.710785},{x:-.577066,y:.586334,z:.568513},{x:-.455902,y:.614345,z:.643998},{x:-.314971,y:.629944,z:.709904},{x:-.162463,y:.629944,z:.759458},{x:-.009708,y:.614345,z:.788978},{x:.132684,y:.586335,z:.799129},{x:.166198,y:.978672,z:.120749},{x:.215245,y:.943209,z:.253036},{x:.307167,y:.943208,z:.126518},{x:.262862,y:.882855,z:.389192},{x:.3618,y:.894429,z:.262863},{x:.451375,y:.882854,z:.129731},{x:.305014,y:.798552,z:.518924},{x:.409951,y:.819913,z:.399604},{x:.506729,y:.819912,z:.266403},{x:.587783,y:.798549,z:.129731},{x:.338569,y:.696561,z:.632593},{x:.447209,y:.723612,z:.525728},{x:.550008,y:.733353,z:.399605},{x:.638194,y:.72361,z:.262864},{x:.706258,y:.696558,z:.126519},{x:.362366,y:.586334,z:.724502},{x:.471599,y:.614344,z:.632594},{x:.57783,y:.629943,z:.518926},{x:.672087,y:.629942,z:.389194},{x:.747366,y:.614342,z:.253038},{x:.801022,y:.586331,z:.12075},{x:.90374,y:.380897,z:-.195376},{x:.921508,y:.266063,z:-.282902},{x:.854992,y:.399094,z:-.331229},{x:.918856,y:.13641,z:-.370264},{x:.861804,y:.276396,z:-.425322},{x:.782446,y:.409229,z:-.469371},{x:.892805,y:-0,z:-.450443},{x:.84666,y:.140059,z:-.513372},{x:.77663,y:.280118,z:-.564251},{x:.68819,y:.40923,z:-.599104},{x:.84529,y:-.133032,z:-.517481},{x:.809019,y:0,z:-.587782},{x:.749882,y:.140059,z:-.646576},{x:.670821,y:.276397,z:-.688189},{x:.579226,y:.399096,z:-.710788},{x:.782501,y:-.253933,z:-.568515},{x:.753368,y:-.133032,z:-.644002},{x:.704293,y:0,z:-.709909},{x:.636088,y:.136411,z:-.759463},{x:.55382,y:.266065,z:-.788982},{x:.465085,y:.3809,z:-.799132},{x:.093451,y:.3809,z:-.919882},{x:.0157,y:.266064,z:-.963827},{x:-.050816,y:.399096,z:-.9155},{x:-.068205,y:.13641,z:-.988302},{x:-.138198,y:.276397,z:-.951055},{x:-.204615,y:.40923,z:-.889193},{x:-.152509,y:-0,z:-.988302},{x:-.226618,y:.140059,z:-.963861},{x:-.296648,y:.280118,z:-.912981},{x:-.357124,y:.40923,z:-.839639},{x:-.230948,y:-.133033,z:-.963829},{x:-.309016,y:-0,z:-.951057},{x:-.383207,y:.140059,z:-.912982},{x:-.447215,y:.276397,z:-.850649},{x:-.497012,y:.399096,z:-.77052},{x:-.298885,y:-.253934,z:-.919883},{x:-.37968,y:-.133033,z:-.915503},{x:-.457527,y:-0,z:-.889196},{x:-.525732,y:.13641,z:-.839642},{x:-.579229,y:.266065,z:-.770522},{x:-.616302,y:.3809,z:-.689266},{x:-.845982,y:.380899,z:-.373136},{x:-.911804,y:.266063,z:-.312769},{x:-.886396,y:.399095,z:-.234577},{x:-.961008,y:.13641,z:-.240533},{x:-.947213,y:.276396,z:-.162458},{x:-.908902,y:.409229,z:-.080178},{x:-.987059,y:0,z:-.160355},{x:-.986715,y:.140059,z:-.082322},{x:-.959966,y:.280117,z:0},{x:-.908902,y:.409229,z:.080178},{x:-.988023,y:-.133031,z:-.078192},{x:-1,y:1e-6,z:0},{x:-.986715,y:.140059,z:.082323},{x:-.947213,y:.276397,z:.162458},{x:-.886395,y:.399095,z:.234577},{x:-.967222,y:-.253931,z:0},{x:-.988023,y:-.13303,z:.078193},{x:-.987059,y:1e-6,z:.160356},{x:-.961008,y:.136411,z:.240534},{x:-.911803,y:.266065,z:.312769},{x:-.845982,y:.3809,z:.373136},{x:-.616302,y:.3809,z:.689266},{x:-.579229,y:.266064,z:.770521},{x:-.497012,y:.399096,z:.77052},{x:-.525732,y:.13641,z:.839641},{x:-.447216,y:.276397,z:.850649},{x:-.357124,y:.40923,z:.839639},{x:-.457527,y:-1e-6,z:.889196},{x:-.383208,y:.140059,z:.912982},{x:-.296649,y:.280118,z:.912981},{x:-.204616,y:.40923,z:.889193},{x:-.379681,y:-.133033,z:.915502},{x:-.309017,y:-1e-6,z:.951056},{x:-.226619,y:.140059,z:.963861},{x:-.138199,y:.276397,z:.951055},{x:-.050817,y:.399096,z:.9155},{x:-.298885,y:-.253934,z:.919883},{x:-.230948,y:-.133033,z:.963828},{x:-.152509,y:-0,z:.988302},{x:-.068206,y:.13641,z:.988302},{x:.015699,y:.266064,z:.963827},{x:.093451,y:.3809,z:.919882},{x:.465085,y:.3809,z:.799132},{x:.55382,y:.266064,z:.788983},{x:.579226,y:.399096,z:.710788},{x:.636088,y:.13641,z:.759463},{x:.67082,y:.276396,z:.68819},{x:.68819,y:.409229,z:.599104},{x:.704293,y:-1e-6,z:.709909},{x:.749882,y:.140058,z:.646576},{x:.77663,y:.280116,z:.564252},{x:.782446,y:.409228,z:.469372},{x:.753368,y:-.133034,z:.644002},{x:.809019,y:-2e-6,z:.587783},{x:.846659,y:.140057,z:.513373},{x:.861804,y:.276394,z:.425323},{x:.854992,y:.399093,z:.33123},{x:.782501,y:-.253934,z:.568515},{x:.845289,y:-.133034,z:.517482},{x:.892805,y:-2e-6,z:.450444},{x:.918856,y:.136407,z:.370266},{x:.921508,y:.266061,z:.282904},{x:.90374,y:.380896,z:.195377},{x:.298886,y:.253934,z:-.919883},{x:.379681,y:.133033,z:-.915502},{x:.230948,y:.133033,z:-.963828},{x:.457527,y:-0,z:-.889196},{x:.309017,y:-0,z:-.951056},{x:.152509,y:0,z:-.988302},{x:.525732,y:-.136411,z:-.839641},{x:.383207,y:-.14006,z:-.912982},{x:.226619,y:-.14006,z:-.963861},{x:.068205,y:-.13641,z:-.988302},{x:.579229,y:-.266065,z:-.770521},{x:.447216,y:-.276398,z:-.850648},{x:.296648,y:-.280119,z:-.91298},{x:.138199,y:-.276398,z:-.951055},{x:-.015699,y:-.266065,z:-.963827},{x:.616302,y:-.3809,z:-.689265},{x:.497012,y:-.399097,z:-.77052},{x:.357124,y:-.409231,z:-.839639},{x:.204615,y:-.409231,z:-.889192},{x:.050817,y:-.399097,z:-.9155},{x:-.093451,y:-.3809,z:-.919881},{x:-.782501,y:.253934,z:-.568515},{x:-.753368,y:.133032,z:-.644002},{x:-.84529,y:.133032,z:-.517482},{x:-.704293,y:-0,z:-.70991},{x:-.809018,y:-0,z:-.587783},{x:-.892805,y:0,z:-.450444},{x:-.636087,y:-.136411,z:-.759464},{x:-.749881,y:-.140059,z:-.646577},{x:-.846659,y:-.140059,z:-.513374},{x:-.918856,y:-.13641,z:-.370265},{x:-.553819,y:-.266065,z:-.788983},{x:-.670819,y:-.276397,z:-.688191},{x:-.776628,y:-.280118,z:-.564253},{x:-.861803,y:-.276396,z:-.425324},{x:-.921507,y:-.266063,z:-.282904},{x:-.465084,y:-.3809,z:-.799132},{x:-.579224,y:-.399096,z:-.710789},{x:-.688189,y:-.40923,z:-.599106},{x:-.782445,y:-.409229,z:-.469374},{x:-.854991,y:-.399094,z:-.331231},{x:-.903739,y:-.380897,z:-.195378},{x:-.782501,y:.253934,z:.568515},{x:-.84529,y:.133032,z:.517482},{x:-.753368,y:.133032,z:.644002},{x:-.892805,y:-0,z:.450444},{x:-.809018,y:0,z:.587783},{x:-.704293,y:0,z:.70991},{x:-.918856,y:-.13641,z:.370265},{x:-.846659,y:-.140059,z:.513374},{x:-.749881,y:-.140059,z:.646577},{x:-.636087,y:-.136411,z:.759464},{x:-.921508,y:-.266063,z:.282904},{x:-.861803,y:-.276396,z:.425324},{x:-.776629,y:-.280118,z:.564253},{x:-.670819,y:-.276397,z:.688191},{x:-.553819,y:-.266065,z:.788983},{x:-.903739,y:-.380897,z:.195378},{x:-.854991,y:-.399094,z:.331231},{x:-.782445,y:-.409229,z:.469374},{x:-.688189,y:-.40923,z:.599106},{x:-.579224,y:-.399096,z:.710789},{x:-.465084,y:-.3809,z:.799132},{x:.298886,y:.253934,z:.919883},{x:.230948,y:.133032,z:.963828},{x:.379681,y:.133033,z:.915502},{x:.152509,y:-0,z:.988302},{x:.309017,y:0,z:.951056},{x:.457527,y:0,z:.889196},{x:.068206,y:-.13641,z:.988302},{x:.226619,y:-.14006,z:.963861},{x:.383207,y:-.14006,z:.912982},{x:.525732,y:-.136411,z:.839641},{x:-.015699,y:-.266065,z:.963827},{x:.138199,y:-.276397,z:.951055},{x:.296648,y:-.280119,z:.91298},{x:.447216,y:-.276398,z:.850648},{x:.579229,y:-.266065,z:.770521},{x:-.093451,y:-.3809,z:.919882},{x:.050817,y:-.399097,z:.9155},{x:.204615,y:-.40923,z:.889192},{x:.357124,y:-.40923,z:.839639},{x:.497012,y:-.399097,z:.77052},{x:.616302,y:-.3809,z:.689266},{x:.967222,y:.253931,z:0},{x:.988023,y:.133031,z:.078192},{x:.988023,y:.133031,z:-.078192},{x:.987059,y:-0,z:.160355},{x:1,y:0,z:0},{x:.987059,y:0,z:-.160355},{x:.961008,y:-.13641,z:.240533},{x:.986715,y:-.140059,z:.082322},{x:.986715,y:-.140059,z:-.082322},{x:.961008,y:-.13641,z:-.240533},{x:.911804,y:-.266064,z:.312769},{x:.947213,y:-.276396,z:.162458},{x:.959966,y:-.280117,z:0},{x:.947213,y:-.276396,z:-.162458},{x:.911804,y:-.266064,z:-.312769},{x:.845982,y:-.380899,z:.373136},{x:.886396,y:-.399095,z:.234576},{x:.908902,y:-.409229,z:.080178},{x:.908902,y:-.409229,z:-.080178},{x:.886396,y:-.399095,z:-.234576},{x:.845982,y:-.380899,z:-.373136},{x:.577066,y:-.586334,z:-.568513},{x:.497009,y:-.696561,z:-.517479},{x:.455902,y:-.614344,z:-.643999},{x:.399272,y:-.798552,z:-.450441},{x:.361804,y:-.723612,z:-.587779},{x:.314971,y:-.629943,z:-.709905},{x:.288916,y:-.882855,z:-.370263},{x:.253366,y:-.819913,z:-.51337},{x:.210087,y:-.733354,z:-.646572},{x:.162463,y:-.629943,z:-.759459},{x:.174138,y:-.943209,z:-.282902},{x:.138197,y:-.894429,z:-.425321},{x:.096779,y:-.819912,z:-.56425},{x:.052789,y:-.723611,z:-.688186},{x:.009708,y:-.614344,z:-.788979},{x:.063482,y:-.978671,z:-.195377},{x:.025407,y:-.943208,z:-.331229},{x:-.016099,y:-.882854,z:-.469371},{x:-.05825,y:-.79855,z:-.599103},{x:-.097915,y:-.69656,z:-.710786},{x:-.132684,y:-.586334,z:-.799129},{x:-.362367,y:-.586334,z:-.724501},{x:-.338569,y:-.696561,z:-.632593},{x:-.471601,y:-.614344,z:-.632593},{x:-.305014,y:-.798552,z:-.518923},{x:-.447211,y:-.723612,z:-.525727},{x:-.577832,y:-.629943,z:-.518924},{x:-.262862,y:-.882855,z:-.389192},{x:-.409952,y:-.819913,z:-.399603},{x:-.55001,y:-.733353,z:-.399603},{x:-.672088,y:-.629942,z:-.389192},{x:-.215245,y:-.943209,z:-.253036},{x:-.361801,y:-.894429,z:-.262863},{x:-.50673,y:-.819912,z:-.266402},{x:-.638195,y:-.723609,z:-.262863},{x:-.747367,y:-.614341,z:-.253036},{x:-.166198,y:-.978671,z:-.120749},{x:-.307168,y:-.943208,z:-.126518},{x:-.451376,y:-.882853,z:-.12973},{x:-.587784,y:-.798549,z:-.12973},{x:-.706258,y:-.696557,z:-.126518},{x:-.801022,y:-.58633,z:-.120749},{x:-.801022,y:-.58633,z:.12075},{x:-.706258,y:-.696558,z:.126518},{x:-.747367,y:-.614341,z:.253037},{x:-.587784,y:-.798549,z:.129731},{x:-.638195,y:-.723609,z:.262864},{x:-.672088,y:-.629941,z:.389193},{x:-.451375,y:-.882853,z:.129731},{x:-.50673,y:-.819911,z:.266403},{x:-.550009,y:-.733352,z:.399605},{x:-.577832,y:-.629942,z:.518925},{x:-.307168,y:-.943208,z:.126519},{x:-.361801,y:-.894428,z:.262864},{x:-.409952,y:-.819912,z:.399605},{x:-.447211,y:-.72361,z:.525729},{x:-.471601,y:-.614343,z:.632594},{x:-.166198,y:-.978671,z:.12075},{x:-.215246,y:-.943208,z:.253038},{x:-.262863,y:-.882854,z:.389194},{x:-.305015,y:-.79855,z:.518925},{x:-.338569,y:-.69656,z:.632594},{x:-.362367,y:-.586333,z:.724502},{x:.719015,y:-.586334,z:-.373135},{x:.753363,y:-.614343,z:-.234576},{x:.64574,y:-.69656,z:-.312768},{x:.772493,y:-.629942,z:-.080177},{x:.670817,y:-.723611,z:-.162457},{x:.55178,y:-.798551,z:-.240532},{x:.772493,y:-.629942,z:.080178},{x:.679849,y:-.733353,z:0},{x:.56654,y:-.819912,z:-.082322},{x:.441423,y:-.882854,z:-.160354},{x:.753364,y:-.614343,z:.234576},{x:.670818,y:-.72361,z:.162458},{x:.566541,y:-.819911,z:.082323},{x:.447211,y:-.894428,z:1e-6},{x:.322869,y:-.943208,z:-.078191},{x:.719016,y:-.586333,z:.373136},{x:.645741,y:-.696559,z:.312769},{x:.551781,y:-.79855,z:.240533},{x:.441424,y:-.882854,z:.160356},{x:.32287,y:-.943208,z:.078193},{x:.205432,y:-.978671,z:1e-6},{x:-.132684,y:-.586334,z:.799129},{x:-.097915,y:-.696561,z:.710785},{x:.009709,y:-.614344,z:.788978},{x:-.058249,y:-.798552,z:.599101},{x:.05279,y:-.723612,z:.688185},{x:.162463,y:-.629944,z:.759458},{x:-.016097,y:-.882855,z:.46937},{x:.09678,y:-.819913,z:.564249},{x:.210089,y:-.733354,z:.646572},{x:.314971,y:-.629943,z:.709905},{x:.025409,y:-.943209,z:.331228},{x:.138199,y:-.894429,z:.425321},{x:.253368,y:-.819912,z:.51337},{x:.361805,y:-.723611,z:.587779},{x:.455903,y:-.614344,z:.643999},{x:.063484,y:-.978671,z:.195377},{x:.17414,y:-.943208,z:.282902},{x:.288918,y:-.882854,z:.370264},{x:.399274,y:-.79855,z:.450441},{x:.497011,y:-.69656,z:.51748},{x:.577067,y:-.586333,z:.568513}],kd_tree_points_with_index=kd_tree_sample_points.map((t,e)=>(t.index=e,t)),e.exports.length=kd_tree_points_with_index.length,e.exports.tree=new r.kdTree(kd_tree_points_with_index,i.euclideanDist,["x","y","z"])},{"./kd-tree-javascript/kdTree.js":5,"./utils.js":9}],8:[function(t,e,n){var i=t("./sample_642.js"),r=i.tree;function a(t,e,n,i,r,a){var x=r*a,z=new Float32Array(i);sum2=new Float32Array(i),pCount=new Uint32Array(i);for(var u=0;u<x;++u){var d=n[u],c=t[u];z[d]+=c,sum2[d]+=c*c,pCount[d]++}var f=new Float32Array(i);for(u=0;u<i;++u){var g=z[u]/pCount[u],m=sum2[u]/pCount[u]-g*g;f[u]=0!==m?1/m:0}for(var p=.1,v=1e-6,w=new Float32Array(5*x),M=new Float32Array(x),b=(u=0,0);u<r;++u)for(var _=0;_<a;++_,++b){var I=f[n[b]];M[b]=I,w[5*b+4]=I}function k(t,n,i,r){var o=(t+i)*a+(n+r),y=t*a+n,s=[(e[4*o+0]-e[4*y+0])/255,(e[4*o+1]-e[4*y+1])/255,(e[4*o+2]-e[4*y+2])/255].reduce((t,e)=>t+e*e,0)+v;return 2*p/s}for(u=1,b=a;u<r;++u)for(_=0;_<a;++_,++b){I=k(u,_,-1,0);w[5*b]=-I,w[5*b+4]+=I}for(u=0,b=1;u<r;++u,++b)for(_=1;_<a;++_,++b){I=k(u,_,0,-1);w[5*b+1]=-I,w[5*b+4]+=I}for(u=0,b=0;u<r;++u,++b)for(_=0;_<a-1;++_,++b){I=k(u,_,0,1);w[5*b+2]=-I,w[5*b+4]+=I}for(u=0,b=0;u<r-1;++u)for(_=0;_<a;++_,++b){I=k(u,_,1,0);w[5*b+3]=-I,w[5*b+4]+=I}var E=0,A=0,j=0;for(u=0;u<w.length;++u)A+=w[u],j+=w[u]*w[u],E=Math.max(E,Math.abs(w[u]));A/=w.length,E=Math.sqrt(j/w.length-A*A)/Math.SQRT1_2;for(u=0;u<w.length;++u)w[u]*=1;var B,L,D,C,F,S,q,U=new Float32Array(x);for(u=0;u<x;++u)U[u]=M[u]*t[u]*1;return L=U,D=t,C=300,F=r,q=function(t,e){for(var n=t.slice(0),i=t.length/5,r=0;r<i-e;++r){var a=5*r,o=1/n[a+4],y=n[a+2]*o,s=n[a+3]*o;n[a+9]-=y*n[a+2];var l=Math.abs(s*n[a+2]);n[a+9]+=l,n[a+5*e+4]+=l,n[a+5*e+4]-=s*n[a+3]}for(var r=i-e;r<i-1;++r){var a=5*r,o=1/n[a+4],y=n[a+2]*o;n[a+9]-=y*n[a+2]}for(var r=1;r<i;++r)n[5*r+1]=n[5*r-3];for(var r=e;r<i;++r)n[5*r]=n[5*(r-e)+3];return n}(B=w,S=a),function(t,e,n,i,r,a,x){var z=new Float32Array(n.length),u=new Float32Array(n.length),d=new Float32Array(n.length),c=new Float32Array(n.length),f=new Float32Array(n.length),g=0,m=0;y(c,e,t,a,x),s(z,n,c),o(u,i,z,x),d=u.slice(0),m=l(u,z),g=m;var p=new Float32Array(n.length);o(p,i,n,x),l(p,p);for(var v=new Date,w=0;w<r;++w){y(f,d,t,a,x);var M=.9*g/l(f,d);h(1,e,M,d),h(1,z,-M,f);var b=l(z,z)/z.length,_=new Date;if(_-v>1e3&&(self.postMessage({signal:"Smoothing with PCG.  Error: "+b}),v=_),b<.2)break;o(u,i,z,x);var I=(g=l(u,z))/m;h(I,d,1,u),m=g}}(B,D,L,q,C,F,S),t}function o(t,e,n,i){var r=t.length;t[0]=n[0]/e[4];for(var a=1;a<i;++a)t[a]=(n[a]-e[5*a+1]*t[a-1])/e[5*a+4];for(a=i;a<r;++a)t[a]=(n[a]-e[5*a]*t[a-i]-e[5*a+1]*t[a-1])/e[5*a+4];for(a=0;a<r;++a)t[a]*=e[5*a+4];t[r-1]/=e[5*r-1];for(a=r-2;a>r-1-i;--a)t[a]=(t[a]-e[5*a+2]*t[a+1])/e[5*a+4];for(a=r-1-i;a>=0;--a)t[a]=(t[a]-e[5*a+3]*t[a+i]-e[5*a+2]*t[a+1])/e[5*a+4]}function y(t,e,n,i,r){t.fill(0);for(var a=0,o=r;a<e.length-r;++a,++o)t[o]+=n[5*o]*e[a];a=0;for(var y=0;a<i;++a,++y)for(o=0;o<r-1;++o,++y)t[y+1]+=n[5*y+5+1]*e[y];for(a=0,y=1;a<i;++a,++y)for(o=1;o<r;++o,++y)t[y-1]+=n[5*y-5+2]*e[y];for(a=r,o=0;a<e.length;++a,++o)t[o]+=n[5*o+3]*e[a];for(a=0;a<e.length;++a)t[a]+=n[5*a+4]*e[a]}function s(t,e,n){for(var i=0;i<e.length;++i)t[i]=e[i]-n[i]}function l(t,e){for(var n=0,i=0;i<t.length;++i)n+=t[i]*e[i];return n}function h(t,e,n,i){for(var r=0;r<e.length;++r)e[r]=t*e[r]+n*i[r]}transmittanceMap=function(t,e,n,o){var y=e*n,s=t,l=i.length,h=new Uint16Array(y),x=new Uint16Array(y),z=new Float32Array(l),u=new Float32Array(y),d=new Float32Array(2*y);self.postMessage({signal:"Clustering pointsâ€¦"});for(var c=0,f=0;f<y;++f){var g=[s[4*f]/255-o[0],s[4*f+1]/255-o[1],s[4*f+2]/255-o[2]],m=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]);u[f]=m;var p={x:g[0]/m,y:g[1]/m,z:g[2]/m},v=r.nearest(p,2,.4),w=v[1][0].index,M=v[0][0].index;h[f]=w,c=Math.max(v[0][1],c),z[w]=Math.max(z[w],m),(v[0][1]-v[1][1]<.01||0==z[M])&&(z[M]=Math.max(z[M],m)),x[f]=v[0][0].index,d[2*f]=v[1][1],d[2*f+1]=v[0][1]}self.postMessage({signal:"Calculating raw transmittanceâ€¦"});var b=[255,255,255];for(f=0;f<4*y;f+=4)b[0]=Math.min(b[0],s[f]),b[1]=Math.min(b[1],s[f+1]),b[2]=Math.min(b[2],s[f+2]);var _=1;for(f=0;f<3;++f)_=Math.min(_,1-b[f]/(255*o[f]));for(var I=new Float32Array(y),k=(f=0,0);f<n;++f)for(var E=0;E<e;++E,++k){var A=_*u[k]/z[h[k]],j=_*u[k]/z[x[k]],B=d[2*k]+d[2*k+1],L=A*d[2*k+1]+j*d[2*k];L/=B;var D=Math.min(s[4*k+0]/255/o[0],s[4*k+1]/255/o[1],s[4*k+2]/255/o[2]);I[k]=Math.max(L,1-D)}if(I.length>2e6){var C=Math.floor(3e5/e),F=Math.ceil(n/C),S=C*e,q=0;for(f=1;q<y;q+=S,++f){self.postMessage({signal:"Dehazing image: block: "+f+" / "+F});var U=q+S<n*e?S:n*e-q;a(new Float32Array(I.buffer,4*q,U),new Uint8ClampedArray(s.buffer,4*q,4*U),new Uint16Array(h.buffer,2*q,U),l,U/e,e)}}return self.postMessage({signal:"Finalizing transmittance mapâ€¦"}),a(I,s,h,l,n,e),I},e.exports=transmittanceMap},{"./sample_642.js":7}],9:[function(t,e,n){flatten=function(t,e=[]){for(let n=0,i=t.length;n<i;n++){const i=t[n];Array.isArray(i)?flatten(i,e):e.push(i)}return e},e.exports.makeColorArray=function(t,e=!1){var n=t.getContext("2d"),i=Array.from(n.getImageData(0,0,t.width,t.height).data);e&&i.map(t=>t/255);for(var r=Array(Math.ceil(i.length/4)).fill(),a=0;a<r.length;++a)r[a]=[i[4*a],i[4*a+1],i[4*a+2]];return r},e.exports.arange=function(t,e,n){for(var i=Math.floor((n-t)/e)+1,r=new Float32Array(i),a=0;a<i;++a)r[a]=t+a*e;return r},e.exports.linRange=function(t,e,n){for(var i=(n-t)/(e-1),r=new Float32Array(e),a=0;a<e;++a)r[a]=t+a*i;return r},e.exports.cartesian=function(t,e){return[].concat(...t.map(t=>e.map(e=>[t,e])))},e.exports.range=function(t,e){return[...Array(e-t).keys()].map(e=>e+t)},e.exports.list2dict3D=function(t){return t.map(t=>({x:t[0],y:t[1],z:t[2]}))},e.exports.dict2list3D=function(t){return t.map(t=>[t.x,t.y,t.z])},e.exports.euclideanDist=function(t,e){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return Math.sqrt(n*n+i*i+r*r)},e.exports.angleDist=function(t,e){var n=t.x*e.x+t.y*e.y+t.z*e.z;return n=Math.max(-1,Math.min(n,1)),Math.acos(n)/Math.PI*2},e.exports.flatten=flatten,e.exports.cloneCanvas=function(t){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),e}},{}],10:[function(t,e,n){var i=t("./functions/gui_utils.js"),r=i.processImage,a=i.sliderChange,o=i.changeGamma,y=i.dehazePreview,s=i.drawDehazed,l=i.mixHaze,h=i.calculateOriginal;window.onload=function(){var t=document.getElementById("fileInput"),e=document.getElementById("fileDisplayArea");t.addEventListener("change",function(n){var i=t.files[0];if(i.type.match(/image.*/)){var a=new FileReader;a.readAsDataURL(i),a.onload=function(t){document.getElementById("airLightSection").style.visibility="visible",document.getElementById("transmittanceDiv").style.visibility="hidden",e.innerHTML="";var n=new Image;n.src=a.result,n.onload=function(){r(n)}}}else e.innerHTML="File not supported!"});var n=document.getElementById("gammaSlide"),i=document.getElementById("gammaVal");n.addEventListener("input",function(t){a(this,i);var e=document.getElementById("originalPic");o(window.origCanvas,e,new Number(this.value))}),i.innerHTML=n.value;var x=document.getElementById("minAirSlide"),z=document.getElementById("minAirVal"),u=document.getElementById("maxAirSlide"),d=document.getElementById("maxAirVal");x.addEventListener("input",function(t){u.value-.05<this.value&&(this.value=u.value-.05),a(this,z)}),z.innerHTML=x.value,u.addEventListener("input",function(t){x.value>this.value-.05&&(this.value=new Number(x.value)+.05),a(this,d)}),d.innerHTML=u.value,document.getElementById("dehazePreviewButton").addEventListener("click",function(t){y()});var c=document.getElementById("distSlide"),f=document.getElementById("distVal"),g=document.getElementById("hazeAmountSlide"),m=document.getElementById("hazeAmountVal"),p=document.getElementById("gammaOutSlide"),v=document.getElementById("gammaOutVal");c.addEventListener("input",function(t){oninput=a(this,f);var e=document.getElementById("originalPic"),n=document.getElementById("dehazeResult");s(e,n,window.transmittance,window.airLight)}),f.innerHTML=c.value,g.addEventListener("input",function(t){a(this,m);var e=window.origCanvas;l(window.dehazeFlat,e.width,e.height,window.dehazedCanvas,window.transmittance,window.airLight,new Number(this.value));var n=new Number(document.getElementById("gammaOutSlide").value);e=document.getElementById("dehazeResult"),o(window.dehazedCanvas,e,1/n)}),m.innerHTML=g.value,p.addEventListener("input",function(t){a(this,v);var e=document.getElementById("dehazeResult");o(window.dehazedCanvas,e,1/new Number(this.value))}),v.innerHTML=p.value,document.getElementById("originalButton").addEventListener("click",function(t){h()})}},{"./functions/gui_utils.js":3}],11:[function(t,e,n){var i=arguments[3],r=arguments[4],a=arguments[5],o=JSON.stringify;e.exports=function(t,e){for(var n,y=Object.keys(a),s=0,l=y.length;s<l;s++){var h=y[s],x=a[h].exports;if(x===t||x&&x.default===t){n=h;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var z={};for(s=0,l=y.length;s<l;s++){z[h=y[s]]=h}r[n]=["function(require,module,exports){"+t+"(self); }",z]}var u=Math.floor(Math.pow(16,8)*Math.random()).toString(16),d={};d[n]=n,r[u]=["function(require,module,exports){var f = require("+o(n)+");(f.default ? f.default : f)(self);}",d];var c={};!function t(e){c[e]=!0;for(var n in r[e][1]){var i=r[e][1][n];c[i]||t(i)}}(u);var f="("+i+")({"+Object.keys(c).map(function(t){return o(t)+":["+r[t][0]+","+o(r[t][1])+"]"}).join(",")+"},{},["+o(u)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,m=new Blob([f],{type:"text/javascript"});if(e&&e.bare)return m;var p=g.createObjectURL(m),v=new Worker(p);return v.objectURL=p,v}},{}],12:[function(t,e,n){var i=t("../functions/min-variance-quantization.js"),r=t("../functions/airlight.js"),a=t("../functions/transmittance.js");e.exports=function(t){onmessage=function(e){var n=e.data,o=n.clusters,y=n.image,s=n.minEst,l=n.maxEst,h=n.picWidth,x=n.picHeight,z=new Date;t.postMessage({signal:"Finding air lightâ€¦"});var u=new i(y.slice(0),o),d=new Date;console.log("Finished quantization in "+(d-z)/1e3+" secs.");var c=r(y,u,s,l);d=new Date,console.log("Finished air light in "+(d-z)/1e3+" secs."),t.postMessage({signal:"Finding transmittance mapâ€¦"});var f=a(y,h,x,c);t.postMessage({signal:"finish",airLight:c,transmittance:f},[f.buffer]),t.close()}}},{"../functions/airlight.js":2,"../functions/min-variance-quantization.js":6,"../functions/transmittance.js":8}],13:[function(t,e,n){var i=t("../functions/min-variance-quantization.js"),r=t("../functions/airlight.js");e.exports=function(t){onmessage=function(e){for(var n=e.data,a=n.clusters,o=n.image,y=n.minEst,s=n.maxEst,l=new Date,h=Array(Math.ceil(o.length/4)).fill(),x=0;x<h.length;++x)h[x]=[o[4*x],o[4*x+1],o[4*x+2]];var z=new i(h.slice(0),a),u=new Date;console.log("Finished quantization in "+(u-l)/1e3+" secs.");var d=r(h,z,y,s);u=new Date,console.log("Finished air light in "+(u-l)/1e3+" secs."),t.postMessage(d),t.close()}}},{"../functions/airlight.js":2,"../functions/min-variance-quantization.js":6}],14:[function(t,e,n){var i=t("../functions/transmittance.js");e.exports=function(t){onmessage=function(e){var n=e.data,r=n.colorArray,a=n.picWidth,o=n.picHeight,y=n.airLight,s=i(r,a,o,y);t.postMessage({signal:"finish",transmittance:s},[s.buffer]),t.close()}}},{"../functions/transmittance.js":8}]},{},[10]);
